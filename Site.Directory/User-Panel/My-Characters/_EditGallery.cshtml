@model RoleplayersGuild.Site.Directory.User_Panel.My_Characters.EditMyCharactersModel

<div class="card mb-4">
    <div class="card-header"><h5 class="mb-0">Manage Existing Images</h5></div>
    <div class="card-body">
        @if (!Model.ExistingImages.Any())
        {
            <p class="text-muted">This gallery is empty. Use the upload form below to add images.</p>
        }
        else
        {
            <form method="post" asp-page-handler="Gallery">
                <input type="hidden" asp-for="Input.CharacterId" />
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                    @for (var i = 0; i < Model.ExistingImages.Count; i++)
                    {
                        var image = Model.ExistingImages[i];
                        <div class="col">
                            <div class="card h-100">
                                <img src="@image.CharacterImageUrl" class="card-img-top" style="aspect-ratio: 1 / 1; object-fit: cover;" />
                                <div class="card-body">
                                    <input type="hidden" name="GalleryInput.Images[@i].ImageId" value="@image.CharacterImageId" />
                                    <div class="mb-2">
                                        <label name="GalleryInput.Images[@i].ImageCaption" class="form-label small">Caption</label>
                                        <textarea name="GalleryInput.Images[@i].ImageCaption" class="form-control form-control-sm" rows="2">@image.ImageCaption</textarea>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" name="GalleryInput.ImagesToDelete" value="@image.CharacterImageId" id="delete-@image.CharacterImageId" />
                                        <label class="form-check-label small text-danger" for="delete-@image.CharacterImageId">Delete</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button type="submit" class="btn btn-primary">Update Gallery</button>
                </div>
            </form>
        }
    </div>
</div>

<div class="card">
    <div class="card-header"><h5 class="mb-0">Upload New Images</h5></div>
    <div class="card-body">
        @if (Model.AvailableSlots > 0)
        {
            <div class="alert alert-info">
                You can upload <strong>@Model.AvailableSlots</strong> more image(s). Your max file size is <strong>@Model.MaxFileSizeMb MB</strong> per image.
            </div>
            <form method="post" enctype="multipart/form-data" asp-page-handler="Upload">
                <input type="hidden" asp-for="Input.CharacterId" />
                <div class="mb-3">
                    <label asp-for="UploadInput.UploadedImages" class="form-label">Select image files</label>
                    <input asp-for="UploadInput.UploadedImages" type="file" class="form-control" multiple accept="image/*" />
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button type="submit" class="btn btn-success">Upload New Images</button>
                </div>
            </form>
        }
        else
        {
            <div class="alert alert-warning">
                You have used all of your available image slots and cannot upload more.
            </div>
        }
    </div>
</div>